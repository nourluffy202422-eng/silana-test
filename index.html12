<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>تنصيب Jadibot</title>
<style>
body { font-family:sans-serif; background:#0d1117; color:#e6edf3; padding:2rem; }
.box { max-width:520px; margin:auto; background:#161b22; padding:1.5rem; border-radius:12px; }
input,button { width:100%; padding:.75rem; margin:.5rem 0; border-radius:8px; border:1px solid #30363d; }
button { background:#238636; color:white; font-weight:bold; cursor:pointer; }
button:disabled { opacity:.6; }
.codebox { font-size:1.5rem; background:#0a0f16; padding:1rem; border:1px dashed #3b434d; border-radius:10px; text-align:center; letter-spacing:3px; margin-top:1rem; }
.alert { margin-top:.5rem; padding:.5rem; border-radius:6px; }
.alert.success { background:#238636; color:white; }
.alert.error { background:#cf222e; color:white; }
</style>
</head>
<body>
<div class="box">
<h2>كود الربط — Jadibot</h2>
<p>دخل رقمك باش نصاوب كود الربط:</p>
<input id="phone" placeholder="+2126XXXXXXX">
<button id="btn" onclick="startPair()">إنشاء الكود</button>
<div id="msg" class="alert" style="display:none;"></div>
<div id="codeSection" style="display:none">
  <p>هاهو الكود ديالك (دخلوه فالأجهزة المرتبطة):</p>
  <div class="codebox" id="pairCode">------</div>
  <button onclick="copyCode()">📋 نسخ الكود</button>
</div>
<pre id="result"></pre>
</div>

<script>
const SERVER_API = "http://localhost:3000/getPair"; // endpoint Node.js proxy
const SERVER_KEY = "ptlc_I5N5OWSc0iAlh4HY3iCx4x69hMZFmo6kzGmfU80jOqv";

function showMessage(msg, type="success") {
  const div = document.getElementById("msg");
  div.textContent = msg;
  div.className = "alert " + type;
  div.style.display = "block";
}

async function startPair() {
  const phone = document.getElementById("phone").value.trim();
  const btn = document.getElementById("btn");
  const codeSection = document.getElementById("codeSection");
  const codeBox = document.getElementById("pairCode");
  const result = document.getElementById("result");

  showMessage("⏳ كنجبدو كود الربط...", "success");
  codeSection.style.display = "none";
  result.textContent = "";
  btn.disabled = true;

  try {
    const resp = await fetch(SERVER_API, {
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization": "Bearer " + SERVER_KEY
      },
      body: JSON.stringify({ number: phone })
    });
    const data = await resp.json();
    if (data.error) throw new Error(data.error);

    codeBox.textContent = data.pairCode;
    codeSection.style.display = "block";
    showMessage("✅ الكود جاهز! استخدمه فالأجهزة المرتبطة.", "success");
    result.textContent = JSON.stringify(data, null, 2);
  } catch(e) {
    showMessage("❌ خطأ: " + e.message, "error");
  } finally { btn.disabled = false; }
}

async function copyCode() {
  const code = document.getElementById("pairCode").textContent;
  try { await navigator.clipboard.writeText(code); alert("📋 تم نسخ الكود!"); }
  catch { alert("ما قدرناش ننسخو"); }
}
</script>
</body>
</html>
