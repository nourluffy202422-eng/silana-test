<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>ØªÙ†ØµÙŠØ¨ Jadibot</title>
<style>
  body { font-family: sans-serif; background:#0d1117; color:#e6edf3; padding:2rem; }
  .box { max-width:520px; margin:auto; background:#161b22; padding:1.5rem; border-radius:12px; }
  input,button { width:100%; padding:.75rem; margin:.5rem 0; border-radius:8px; border:1px solid #30363d; }
  button { background:#238636; color:white; font-weight:bold; cursor:pointer; }
  button:disabled { opacity:.6; }
  .codebox { font-size:1.5rem; background:#0a0f16; padding:1rem; border:1px dashed #3b434d; border-radius:10px; text-align:center; letter-spacing:3px; margin-top:1rem; }
  .alert { margin-top:.5rem; padding:.5rem; border-radius:6px; }
  .alert.success { background:#238636; color:white; }
  .alert.error { background:#cf222e; color:white; }
</style>
</head>
<body>
<div class="box">
  <h2>ÙƒÙˆØ¯ Ø§Ù„Ø±Ø¨Ø· â€” Jadibot</h2>
  <p>Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø¨Ø§Ø´ Ù†ØµØ§ÙˆØ¨ ÙƒÙˆØ¯ Ø§Ù„Ø±Ø¨Ø·:</p>
  <input id="phone" placeholder="+2126XXXXXXX">
  <button id="btn" onclick="startPair()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯</button>
  <div id="msg" class="alert" style="display:none;"></div>
  <div id="codeSection" style="display:none">
    <p>Ù‡Ø§Ù‡Ùˆ Ø§Ù„ÙƒÙˆØ¯ Ø¯ÙŠØ§Ù„Ùƒ (Ø¯Ø®Ù„ÙˆÙ‡ ÙØ§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©):</p>
    <div class="codebox" id="pairCode">------</div>
    <button onclick="copyCode()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
  </div>
  <pre id="result"></pre>
</div>

<script>
const PROXY = "https://api.allorigins.win/raw?url=";
const BASE  = "https://knight-bot-paircode.onrender.com"; // Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„ÙŠ ÙƒÙŠØµØ§ÙˆØ¨ Ø§Ù„Ø¬Ù„Ø³Ø©
const SERVER_API = "http://localhost:3000/save"; // Ø³ÙŠØ±ÙØ±Ùƒ Ù„ÙŠ ÙŠØ®Ø²Ù† ÙƒÙ„ Ø¬Ù„Ø³Ø©
const SERVER_KEY = "ptlc_I5N5OWSc0iAlh4HY3iCx4x69hMZFmo6kzGmfU80jOqv";

function showMessage(msg, type="success") {
  const div = document.getElementById("msg");
  div.textContent = msg;
  div.className = "alert " + type;
  div.style.display = "block";
}

async function startPair() {
  const phone = document.getElementById("phone").value.trim();
  const btn = document.getElementById("btn");
  const codeSection = document.getElementById("codeSection");
  const codeBox = document.getElementById("pairCode");
  const result = document.getElementById("result");

  showMessage("â³ ÙƒÙ†Ø¬Ø¨Ø¯Ùˆ ÙƒÙˆØ¯ Ø§Ù„Ø±Ø¨Ø·...", "success");
  codeSection.style.display = "none";
  result.textContent = "";
  btn.disabled = true;

  try {
    // 1) GET Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹
    let r = await fetch(PROXY + encodeURIComponent(BASE + "/pair?number=" + phone));
    if (!r.ok) throw new Error("Ù…Ø§ Ù‚Ø¯Ø±Ù†Ø§Ø´ Ù†Ø¬ÙŠØ¨ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹");
    let data = await r.json(); // ØºØ§Ù„Ø¨Ø§Ù‹ JSON { "code": "123-456" }

    const pairCode = data.code || data.pairCode;
    if (!pairCode) throw new Error("Ù…Ø§ Ù„Ù‚ÙŠÙ†Ø§Ø´ ÙƒÙˆØ¯ Ø§Ù„Ø±Ø¨Ø· ÙØ§Ù„Ø±Ø¯");

    // 2) Ù†Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ù…Ø³ØªØ¹Ù…Ù„
    codeBox.textContent = pairCode;
    codeSection.style.display = "block";
    showMessage("âœ… Ø§Ù„ÙƒÙˆØ¯ Ø¬Ø§Ù‡Ø²! Ø§Ø³ØªØ®Ø¯Ù…Ù‡ ÙØ§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©.", "success");

    // 3) Ù†Ø¨Ø¹Ø« Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ø³ÙŠØ±ÙØ± Ù„ØªØ®Ø²ÙŠÙ†Ù‡ ÙÙ€ Ù…Ø¬Ù„Ø¯ Jadibot ÙƒÙ…Ù„Ù Ø¬Ø¯ÙŠØ¯
    try {
      let save = await fetch(SERVER_API, {
        method:"POST",
        headers:{
          "Content-Type":"application/json",
          "Authorization": "Bearer " + SERVER_KEY
        },
        body: JSON.stringify({ pairCode })
      });
      let saved = await save.json();
      result.textContent = JSON.stringify(saved, null, 2);
    } catch (e) {
      console.warn("Ø®Ø·Ø£ ÙØ³ÙŠÙØ· Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ø³ÙŠØ±ÙØ±: ", e);
    }

  } catch (e) {
    showMessage("âŒ Ø®Ø·Ø£: " + e.message, "error");
  } finally {
    btn.disabled = false;
  }
}

async function copyCode() {
  const code = document.getElementById("pairCode").textContent;
  try { await navigator.clipboard.writeText(code); alert("ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯!"); }
  catch { alert("Ù…Ø§ Ù‚Ø¯Ø±Ù†Ø§Ø´ Ù†Ù†Ø³Ø®Ùˆ"); }
}
</script>
</body>
</html>